{
  config,
  withSystem,
  lib,
  ...
}:
let
  plugins = [
    "better-mouse-mode"
    "yank"
    "sesh"
    "tmux-thumbs"
    "fzf-tmux-url"
    "tilish"
    "vim-tmux-navigator"
    "tmux-fzf"
    "catppuccin"
  ];
in
{
  text.readme.parts.tmux =
    # markdown
    ''
      # Tmux 

      Tmux with configurations

      ## Links

      - [extrakto](https://github.com/laktak/extrakto)
      - [jakehamiltons tmux](https://github.com/jakehamilton/tmux)
    '';

  # |> map (file: "- `${file.path_}`")
  # text.readme.tmux =
  #   withSystem (builtins.head config.systems) plugins
  #   |> map (file: "|        ${file}            |                        |")
  #   |> lib.concat [
  #     # markdown
  #     ''
  #       # Tmux
  #
  #       Standalone tmux with configurations, powered by [nixvim](https://github.com/nix-community/nixvim)
  #
  #       # Tmux plugins
  #
  #       | Name               | Description            |
  #       | ------------------ | ---------------------- |
  #     ''
  #   ]
  #   |> lib.concatLines
  #   |> (s: s + "\n");

  text.readme.parts.tmuxPlugins = withSystem (builtins.head config.systems) (
    { pkgs, ... }:
    let
      fallbackDescriptions = {
        yank = "Better yank support";
        t-smart-tmux-session-manager = "Smart session managment";
        vim-tmux-navigator = "Better support for navigation with tmux and vim";
      };
      plugins = [
        "better-mouse-mode"
        "yank"
        "t-smart-tmux-session-manager"
        "tmux-thumbs"
        "fzf-tmux-url"
        "tilish"
        "vim-tmux-navigator"
        "tmux-fzf"
        "catppuccin"
      ];

      pluginRows = lib.map (
        name:
        let
          plugin = pkgs.tmuxPlugins.${name};
          meta = plugin.meta or { };
          desc = meta.description or fallbackDescriptions.${name} or "No description.";
          url = meta.homepage or meta.url or null;
          nameCell = if url != null then "[${name}](${url})" else name;
        in
        ''
          - ${nameCell}

          ${desc}
        ''
      ) plugins;
    in
    lib.concatLines (
      [
        ''
          ## Tmux

          Standalone tmux with configurations, powered by [nixvim](https://github.com/nix-community/nixvim)

          ### Tmux plugins
        ''
      ]
      ++ pluginRows
    )
  );

  perSystem =
    { pkgs, ... }:
    {
      packages.tmux =
        let
          tmuxConf = ''
            # This file is generated by https://github.com/dsnn/flakes/tmux

            #========================#
            #          BASE          #
            #========================#

            #========================#
            #         PLUGINS        #
            #========================#
          '';
          tmuxConfFile = pkgs.writeText "tmux.conf" tmuxConf;
        in
        pkgs.writeShellApplication {
          name = "tmux-wrapper";
          runtimeInputs = [ pkgs.tmux ];
          text = "tmux -f ${tmuxConfFile} \"$@\"";
        };
    };
}
